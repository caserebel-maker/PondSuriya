<!DOCTYPE html>
<html lang="th">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard - ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏£‡πâ‡∏≠‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</title>
    <link rel="stylesheet" href="../css/style.css">
    <style>
        .admin-layout {
            display: grid;
            grid-template-columns: 250px 1fr;
            min-height: 100vh;
        }

        .sidebar {
            background: var(--gray-900);
            color: white;
            padding: var(--space-6);
            display: flex;
            flex-direction: column;
        }

        .sidebar-brand {
            font-size: var(--font-size-xl);
            font-weight: bold;
            display: flex;
            align-items: center;
            gap: var(--space-3);
            margin-bottom: var(--space-12);
        }

        .sidebar-menu {
            list-style: none;
            display: flex;
            flex-direction: column;
            gap: var(--space-2);
        }

        .sidebar-menu a {
            display: flex;
            align-items: center;
            gap: var(--space-3);
            padding: var(--space-3) var(--space-4);
            color: var(--gray-400);
            border-radius: var(--radius-lg);
            transition: all var(--transition-fast);
        }

        .sidebar-menu a:hover,
        .sidebar-menu a.active {
            background: var(--primary-600);
            color: white;
        }

        .main-content {
            background: var(--gray-50);
            padding: var(--space-8);
        }

        .top-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: var(--space-8);
        }

        .user-profile {
            display: flex;
            align-items: center;
            gap: var(--space-3);
        }

        .stat-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: var(--space-6);
            margin-bottom: var(--space-8);
        }

        .stat-card {
            background: white;
            padding: var(--space-6);
            border-radius: var(--radius-xl);
            box-shadow: var(--shadow-sm);
        }

        .stat-card-title {
            color: var(--gray-500);
            font-size: var(--font-size-sm);
            margin-bottom: var(--space-2);
        }

        .stat-card-value {
            font-size: var(--font-size-3xl);
            font-weight: bold;
            color: var(--gray-900);
        }

        .recent-reports {
            background: white;
            padding: var(--space-6);
            border-radius: var(--radius-xl);
            box-shadow: var(--shadow-sm);
        }

        .table {
            width: 100%;
            border-collapse: collapse;
        }

        .table th,
        .table td {
            text-align: left;
            padding: var(--space-4);
            border-bottom: 1px solid var(--gray-100);
        }

        .table th {
            color: var(--gray-500);
            font-weight: 500;
            font-size: var(--font-size-sm);
        }

        @media (max-width: 768px) {
            .admin-layout {
                grid-template-columns: 1fr;
            }

            .sidebar {
                display: none;
            }
        }
    </style>
</head>

<body>
    <div class="admin-layout">
        <aside class="sidebar">
            <div class="sidebar-brand">
                <div
                    style="width: 30px; height: 30px; background: var(--primary-500); border-radius: 50%; display: flex; align-items: center; justify-content: center;">
                    SP</div>
                Admin Panel
            </div>
            <ul class="sidebar-menu">
                <li><a href="dashboard.html" class="active">üìä ‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏°</a></li>
                <li><a href="#" onclick="alert('Coming Soon')">üìë ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</a></li>
                <li><a href="#" onclick="alert('Coming Soon')">‚öôÔ∏è ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤</a></li>
            </ul>
            <div style="margin-top: auto;">
                <button onclick="authService.logout()" class="btn w-full"
                    style="background: rgba(255,255,255,0.1); color: white;">üö™ ‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö</button>
            </div>
        </aside>

        <main class="main-content">
            <div class="top-bar">
                <h1 id="pageTitle">‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏°‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ</h1>
                <div class="user-profile">
                    <span id="adminName">Admin</span>
                    <div style="width: 40px; height: 40px; background: var(--gray-200); border-radius: 50%;"></div>
                </div>
            </div>

            <!-- Stats -->
            <div class="stat-cards">
                <div class="stat-card">
                    <h3 class="stat-card-title">‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏£‡πâ‡∏≠‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</h3>
                    <div class="stat-card-value" id="totalReports">-</div>
                </div>
                <div class="stat-card">
                    <h3 class="stat-card-title">‡∏£‡∏≠‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö</h3>
                    <div class="stat-card-value" style="color: var(--accent-500)" id="pendingReports">-</div>
                </div>
                <div class="stat-card">
                    <h3 class="stat-card-title">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£</h3>
                    <div class="stat-card-value" style="color: var(--primary-500)" id="progressReports">-</div>
                </div>
                <div class="stat-card">
                    <h3 class="stat-card-title">‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô‡πÅ‡∏•‡πâ‡∏ß</h3>
                    <div class="stat-card-value" style="color: var(--success)" id="completedReports">-</div>
                </div>
            </div>

            <!-- Recent Table -->
            <div class="recent-reports">
                <div class="flex justify-between items-center mb-4">
                    <h3>‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î</h3>
                    <a href="#" class="btn btn-sm btn-secondary">‡∏î‡∏π‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</a>
                </div>
                <div style="overflow-x: auto;">
                    <table class="table">
                        <thead>
                            <tr>
                                <th>Tracking ID</th>
                                <th>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÅ‡∏à‡πâ‡∏á</th>
                                <th>‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà</th>
                                <th>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</th>
                                <th>‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£</th>
                            </tr>
                        </thead>
                        <tbody id="reportsTableBody">
                            <tr>
                                <td colspan="5" class="text-center">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </main>
    </div>

    <!-- Scripts -->
    <script src="../js/services/auth-service.js"></script>
    <script src="../js/services/db-service.js"></script>
    <script>
        // Auth Guard
        authService.checkAuth();

        document.getElementById('adminName').textContent = authService.getUser().user;

        // Load Data
        async function loadDashboard() {
            const reports = await dbService.getAllReports();

            // Calc Stats
            document.getElementById('totalReports').textContent = reports.length;
            document.getElementById('pendingReports').textContent = reports.filter(r => r.status === 'pending').length;
            document.getElementById('progressReports').textContent = reports.filter(r => r.status === 'in_progress').length;
            document.getElementById('completedReports').textContent = reports.filter(r => r.status === 'completed').length;

            // Render Table (Last 5)
            const tbody = document.getElementById('reportsTableBody');
            tbody.innerHTML = '';

            const recent = reports.slice(0, 5); // Assuming saved in chronological order, usually unshift, so 0-5 is new

            if (recent.length === 0) {
                tbody.innerHTML = '<tr><td colspan="5" class="text-center">‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</td></tr>';
                return;
            }

            const statusMap = {
                'pending': '<span class="badge badge-pending">‡∏£‡∏≠‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö</span>',
                'accepted': '<span class="badge" style="background:#e0f2fe; color:#0284c7;">‡∏£‡∏±‡∏ö‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á‡πÅ‡∏•‡πâ‡∏ß</span>',
                'in_progress': '<span class="badge badge-progress">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£</span>',
                'completed': '<span class="badge badge-completed">‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô</span>'
            };

            const categoryMap = {
                'road': '‡∏ñ‡∏ô‡∏ô/‡∏ó‡∏≤‡∏á‡πÄ‡∏ó‡πâ‡∏≤',
                'flood': '‡∏ô‡πâ‡∏≥‡∏ó‡πà‡∏ß‡∏°',
                'electric': '‡πÑ‡∏ü‡∏ü‡πâ‡∏≤',
                'trash': '‡∏Ç‡∏¢‡∏∞',
                'safety': '‡∏Ñ‡∏ß‡∏≤‡∏°‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢',
                'other': '‡∏≠‡∏∑‡πà‡∏ô‡πÜ'
            };

            recent.forEach(r => {
                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td><strong>${r.id}</strong></td>
                    <td>${new Date(r.createdAt).toLocaleDateString('th-TH')}</td>
                    <td>${categoryMap[r.category] || r.category}</td>
                    <td>${statusMap[r.status] || r.status}</td>
                    <td>
                        <a href="manage.html?id=${r.id}" class="btn btn-sm btn-primary">‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£</a>
                    </td>
                `;
                tbody.appendChild(tr);
            });
        }

        loadDashboard();
    </script>
</body>

</html>